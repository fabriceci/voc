{"version":3,"sources":["App.js","index.js"],"names":["modules","words","getRatio","attempt","success","Math","round","loadGoogleSheet","a","force","result","JSON","parse","localStorage","getItem","doc","GoogleSpreadsheet","useApiKey","loadInfo","sheet","sheetsByIndex","getRows","rows","data","map","r","fr","trim","undefined","es","type","module","modulesList","forEach","value","index","findIndex","e","push","includes","setItem","stringify","getStatus","status","Map","updateStatus","key","point","has","keyValue","get","attemps","error","set","App","useState","vocabulary","setVocabulary","current","setCurrent","input","setInput","setError","show","setShow","setModule","setType","tilde","setTilde","readWord","message","synth","window","speechSynthesis","join","msg","SpeechSynthesisUtterance","pitch","rate","lang","voice","getVoices","find","speak","console","checkWord","useCallback","toLowerCase","target","t","length","useEffect","sort","random","loadSheet","handleEnter","document","addEventListener","removeEventListener","inputClass","filterModule","filter","addFilter","style","textAlign","currentWords","currentInput","normalize","replace","resultForWord","className","onChange","onClick","width","flexGrow","padding","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.8d4c5e47.chunk.js","sourcesContent":["import {useEffect, useState, useCallback} from 'react';\nimport {GoogleSpreadsheet} from 'google-spreadsheet';\n\nlet modules = []\nlet words = []\n\nconst getRatio = (attempt, success) => {\n    if(success === 0) return 0;\n    return Math.round((success/attempt) * 100 * 100) / 100\n}\n\nasync function loadGoogleSheet(force = false){\n\n    let result = JSON.parse(localStorage.getItem(\"words\"));\n    if(!result || force){\n\n        const doc = new GoogleSpreadsheet('1lA849BH1mhhAlnmhamfNnkXQVGJmEz_XpD5Fqbco5m0')\n        doc.useApiKey('AIzaSyB3fhuMVnaW77F8ZiDu_mo_xJKdKzQo6tU')\n        await doc.loadInfo();\n        const sheet = doc.sheetsByIndex[0]; // or use doc.sheetsById[id]\n        const rows = await sheet.getRows();\n        const data = rows.map(r => {\n            const data = {\n                fr: r['fr'] ? r['fr'].trim() : undefined,\n                es: r['es'] ? [r['es'].trim()] : [],\n                type:  r['type'] ? r['type'].trim() : undefined,\n                module: r['module'] ? r['module'].trim() : undefined,\n            }\n            return data;\n        })\n\n        result = []\n        var modulesList = []\n        data.forEach(value => {\n            // Restructuration\n            var index = result.findIndex(e => e.fr === value.fr);\n            if(index === -1){\n                result.push(value);\n            } else {\n                result[index].es.push(...value.es);\n            }\n\n            // liste des modules\n\n            if (value.module && !modulesList.includes(value.module)) {\n                modulesList.push(value.module);\n            }\n        })\n        // ajout dans la variable globale et dans le storage\n        localStorage.setItem(\"words\", JSON.stringify(result));\n        localStorage.setItem(\"modules\", JSON.stringify(modulesList));\n\n    }\n\n    words = [...result];\n    modules = [...JSON.parse(localStorage.getItem(\"modules\"))]\n}\n\nconst getStatus = () => {\n    const status = JSON.parse(localStorage.getItem(\"status\"));\n    if(!status){\n        return new Map();\n    }else {\n        return new Map(status);\n    }\n}\n\nconst updateStatus = (key, point) => {\n    let status = getStatus();\n    if(status.has(key)){\n        var keyValue = status.get(key);\n        keyValue.attemps += 1;\n        if(point === 1){\n            keyValue.success += 1;\n        } else {\n            keyValue.error += 1;\n        }\n        status.set(key, keyValue);\n    } else {\n        status.set(key, {attemps: 1, success: point === 1 ? 1 : 0, error: point ===-1 ? 1 : 0 })\n    }\n    localStorage.setItem(\"status\", JSON.stringify([...status]));\n}\n\nfunction App() {\n    const [vocabulary, setVocabulary] = useState([]);\n    const [current, setCurrent] = useState(0)\n    const [input, setInput] = useState('')\n    const [error, setError] = useState(false)\n    const [show, setShow] = useState(false)\n    const [module, setModule] = useState('all')\n    const [type, setType] = useState('all')\n    const [tilde, setTilde] = useState(false)\n\n    const readWord = (message) => {\n        setError(true)\n        var synth = window.speechSynthesis;\n        if (!synth) {\n            console.error(\"No speech syntesis API\");\n            return;\n        }\n\n        if(typeof message !== 'string'){\n            message = vocabulary[current].es.join(\",\");\n        }\n\n        var msg = new SpeechSynthesisUtterance(message);\n        msg.pitch = 1.1;\n        msg.rate = 1;\n        msg.lang = 'es-ES'\n        var voices = speechSynthesis.getVoices();\n        var voice = voices.find(e => e.lang === 'es-ES')\n        msg.voice = voice;\n\n        synth.speak(msg);\n    }\n\n    const checkWord = useCallback(() => {\n        const value = input.toLowerCase().trim();\n        const target = vocabulary[current].es;\n        if (value.trim() === '') return;\n        if (target.map(t => t.toLowerCase()).includes(value)) {\n            setCurrent(e => (e+1) === vocabulary.length ? 0 : e+ 1)\n            setInput('')\n            setError(false);\n            setShow(false);\n            setTilde(false);\n            updateStatus(vocabulary[current].fr, error || show ? -1 : 1)\n        } else {\n            setError(true);\n        }\n    }, [current, vocabulary, input]);\n\n\n    useEffect(() => {\n        const loadSheet = async () => {\n            await loadGoogleSheet();\n            setVocabulary([...words].sort(() => Math.random() - 0.5));\n        }\n\n        loadSheet();\n\n    }, [])\n\n    useEffect(() => {\n        const handleEnter = function (e) {\n            if(e.key === '@'){\n                setShow(e => true)\n            }\n            if (e.key === 'Control') {\n                readWord()\n            }\n            if (e.key === 'Enter') {\n                checkWord();\n            }\n        }\n\n        document.addEventListener('keydown', handleEnter);\n        return () => {\n            document.removeEventListener('keydown', handleEnter);\n        };\n    }, [checkWord])\n\n    useEffect(() => {\n        if(tilde === true){\n            readWord(\"¿Dónde está la tilde?\")\n        }\n    }, [tilde])\n\n    const nextWord = () => {\n        setCurrent(e => (e+1) === vocabulary.length ? 0 : e+ 1)\n        setInput('')\n        setShow(false);\n        setError(false);\n        setTilde(false);\n        updateStatus(vocabulary[current].fr, -1)\n    }\n\n\n    const filterModule = (module, filter) => {\n        var result = []\n        if (module === 'all') {\n            result = [...words];\n        } else {\n            result = words.filter(e => e.module === module);\n        }\n        const status = getStatus()\n        if(filter === 'error'){\n            result = result.filter(e => !status.has(e.fr) || getRatio(status.get(e.fr).attemps, status.get(e.fr).success) < 80);\n        } else if(filter === 'error-only') {\n            result = result.filter(e => status.has(e.fr) && getRatio(status.get(e.fr).attemps, status.get(e.fr).success) < 80);\n        }\n\n        setVocabulary(result);\n    }\n\n    const addFilter = (type, value) => {\n        if(type === 'module'){\n            filterModule(value, type);\n            setModule(value)\n        } else {\n            filterModule(module, value)\n            setType(value)\n        }\n    }\n\n    if (vocabulary.length === 0) {\n        return <div style={{textAlign: 'center'}}>Chargement...</div>\n    }\n\n    var inputClass;\n    var currentWords =  vocabulary[current].es.map(t => t.toLowerCase());\n    var currentInput = input.toLowerCase().trim()\n    if (error) inputClass = 'error';\n    if (error && currentWords.includes(currentInput)){\n        inputClass = 'success'\n    } else if (error && currentWords.map(e => e.normalize(\"NFD\").replace(/[\\u0300-\\u036f]/g, \"\")).includes(currentInput)){\n        inputClass = 'warning'\n        if(!tilde){\n            setTilde(true)\n        }\n\n    }\n    const resultForWord = getStatus().get(vocabulary[current].fr);\n    return (\n        <div className=\"App\">\n            <div className=\"status\">\n                <div>{current + 1}/{vocabulary.length + 1}</div>\n                <div>{vocabulary[current].module}</div>\n                <div>\n                    <div>\n                        <select value={module} onChange={(e) => addFilter('module', e.target.value)}>\n                            <option key=\"all\" value=\"all\">Tous les modules</option>\n                            {\n                                modules.map(e => <option key={e}>{e}</option>)\n                            }\n                        </select>\n                    </div>\n                    <div>\n                        <select value={type} onChange={(e) => addFilter('type', e.target.value)}>\n                            <option key=\"all\" value=\"all\">pas de filtre</option>\n                            <option key=\"error\" value=\"error\">nouveau et taux d'erreur > 80% </option>\n                            <option key=\"error-only\" value=\"error-only\">juste les erreurs</option>\n                        </select>\n                    </div>\n                </div>\n            </div>\n            <ul className=\"helper\">\n                <li><kbd onClick={() => setInput(input => input += 'ñ')}>ñ</kbd></li>\n                <li><kbd onClick={() => setInput(input => input += 'á')}>á</kbd></li>\n                <li><kbd onClick={() => setInput(input => input += 'ó')}>ó</kbd></li>\n                <li><kbd onClick={() => setInput(input => input += 'í')}>í</kbd></li>\n            </ul>\n\n            <div className=\"statistics\">{ resultForWord ? getRatio(resultForWord.attemps, resultForWord.success) + ' % de réussite' : 'nouveau'}</div>\n            <div className=\"currentWord alert alert-info\">{vocabulary[current].fr}</div>\n\n\n            <div className=\"input-group mb-3\" style={{width: '100%'}}>\n                <input style={{flexGrow: 1, padding: '0 15px'}} className={inputClass} type=\"text\" value={input}\n                       onChange={(e) => setInput(e.target.value)}/>\n                <div className=\"input-group-append\">\n                    <button onClick={checkWord} className=\"btn btn-primary\">Valider</button>\n                </div>\n            </div>\n            {show &&\n            <p className=\"answer\">{vocabulary[current].es.join(',')}</p>\n            }\n\n            <div className=\"solutions\">\n                {!show &&\n                <button key=\"show\" className=\"btn btn-danger\" onClick={() => setShow(true)}>🕶 Voir la réponse</button>\n                }\n                {show &&\n                <button key=\"next\" className=\"btn btn-danger\" onClick={nextWord}>Next</button>\n                }\n                <button key=\"read\" className=\"btn btn-warning\" onClick={readWord}>Écouter la\n                    réponse 🔊\n                </button>\n            </div>\n        </div>\n    );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}